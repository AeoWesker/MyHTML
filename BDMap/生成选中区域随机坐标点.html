<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=1nCQCnDr3Nt3GKDVeBmKGe2Y"></script>
	<script type="text/javascript" src="http://api.map.baidu.com/library/GeoUtils/1.2/src/GeoUtils_min.js"></script>
	<style type="text/css">
		html,body{
			width: 100%;
			height: 100%;
		}
		#closeLine{
			padding: 15px;
			width: 200px;
			margin: 20px auto;
			background: skyblue;
			font-size: 22px;
			color: #ffffff;
			border-radius: 10px;
			cursor: pointer;
		}
	</style>
</head>
<body>
    <div id="allmap" style="width:100%;height:600px"></div>
    <div id="divInfo"></div>
    <fieldset id="">
    	<legend>配置信息</legend>
    	<ul>
    		<li>
    			<span>城市:</span>
    			<input type="text" placeholder="请输入城市名称" />
    		</li>
    		<li>
    			<span>中心坐标</span>
    			<input type="text" placeholder="请输入城市中心点坐标" />
    		</li>
    	</ul>
    	<div>提交</div>
    </fieldset>
    <div id="closeLine">开始生成随机坐标点</div>
</body>
</html>
<script type="text/javascript">
	
	const total = 80; // 生成的随机点的大小
	const totalPointList = []; // 坐标点集合
	const centerPoint = [114.031040, 22.324386]; // 中央坐标区域
	const offetStepX = 5;
	const offetStepY = 5;
	const cityName = '上海市';
	const linesPoint  = [];
    window.onload = function () {
		var pointss="";
        var map = new BMap.Map("allmap");
        map.centerAndZoom(new BMap.Point(centerPoint[0], centerPoint[1]), 10);
        var polyline = new BMap.Polyline(); //折线覆盖物
		// 绘制折线图覆盖区域
		map.addEventListener("click",function(e){   //单击地图，形成折线覆盖物
		    newpoint = new BMap.Point(e.point.lng,e.point.lat);
	        linesPoint.push(newpoint);  //将新增的点放到数组中
	        polyline.setPath(linesPoint);   //设置折线的点数组
	        map.addOverlay(polyline);   //将折线添加到地图上
	        
		});
		
		document.getElementById('closeLine').onclick = function (){
			
			var polygon = new BMap.Polygon(linesPoint, {strokeColor:"blue", strokeWeight:2, strokeOpacity:0.5});  //创建多边形  
		    map.addOverlay(polygon);   //增加多边形  
	        
	        setTimeout(()=>{
	         	getRandomPointList(polygon);
	         }, 200)
		}
		
		
		function getRandomPointList(ply){
			var res = "", minX = centerPoint[0], minY = centerPoint[1], x = 0, y = 0,pt=null;
			for (var j = 0; j < total; j++) {
                    x = minX + getRandom() * offetStepX;
                    y = minY + getRandom() * offetStepY;
                    pt = new BMap.Point(x, y);
                    addMarker(map, pt);
                    if (BMapLib.GeoUtils.isPointInPolygon(pt, ply)) {
                      totalPointList.push({
							name: "", 
							value: 10, 
							geoCoord: [x, y]
						})
                    }
                }
				for (var k = 0; k < total; k++) {
                    x = minX + getRandom() * offetStepX;
                    y = minY - getRandom() * offetStepY;
                    pt = new BMap.Point(x, y);
                    addMarker(map, pt);
                    if (BMapLib.GeoUtils.isPointInPolygon(pt, ply)) {
						 totalPointList.push({
							name: "", 
							value: 10, 
							geoCoord: [x, y]
						})
                    }
                }
				for (var l = 0; l < total; l++) {
                    x = minX - getRandom() * offetStepX;
                    y = minY + getRandom() * offetStepY;
                    pt = new BMap.Point(x, y);
                    addMarker(map, pt);
                    if (BMapLib.GeoUtils.isPointInPolygon(pt, ply)) {
						 totalPointList.push({
							name: "", 
							value: 10, 
							geoCoord: [x, y]
						})
                    }
                }
				for (var m = 0; m < total; m++) {
					console.log('start');
                    x = minX - getRandom() * offetStepX;
                    y = minY - getRandom() * offetStepY;
                    pt = new BMap.Point(x, y)
                    addMarker(map, pt);
                    if (BMapLib.GeoUtils.isPointInPolygon(pt, ply)) {
						 totalPointList.push({
							name: "", 
							value: 10, 
							geoCoord: [x, y]
						})
                    }
                }
				console.log(JSON.stringify(totalPointList));
		}
		
    }


    function getRandom() {
        return Math.random() / 10;
    }
    
    function addMarker(map, point){
        var myIcon = new BMap.Icon("img/red_icon.png", new BMap.Size(20, 26), {
        });


        var marker = new BMap.Marker(point, { icon: myIcon });

        map.addOverlay(marker);

        marker.enableDragging();
    }
</script>